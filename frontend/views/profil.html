<!-- achievement, titel, bild, name, aktuelle Gruppen, akt. Punkte, historie, -->

<div class="container">
	<div class="row m-2">
		<div class="col-md-4 image-upload">
			<form action="pathnochnichtvorhanden" id="form-image">
				<label for="file-input">
					<img src="" style="height: 10rem; width: 10rem; border-radius: 50rem; cursor: pointer;" class="img-thumbnail img-fluid" id="profilBild" />	
				</label>
				<input type="file" id="file-input" style="display: none;" name="newImage">
			</form>
		</div>
		<div class="col-md-8">
			<div>
				<input type="text" name="nname" disabled value="" id="name"></input>
			</div>
			<div>
				<label id="cur_Titel">-Bankwärmer-</label>
				<i class="far fa-edit" id="editTitel" style="cursor: pointer; display:none;"></i>
				<ul class="list-inline">
					<li class="list-inline-item">
						<i class="fab fa-angellist"></i>
					</li>
					<li class="list-inline-item">
						<i class="fab fa-angellist"></i>
					</li>
					<li class="list-inline-item">
						<i class="fab fa-angellist"></i>
					</li>
					<li class="list-inline-item">
						<i class="fab fa-angellist"></i>
					</li>
					<li class="list-inline-item">
						<i class="fab fa-angellist"></i>
					</li>
				</ul>
			</div>
			<div>
				<label>aktuelle Punktzahl: <i id="aktPkt"></i></label>  
				<br />
				<label>aktuelle Platzierung: <i id="aktPlatz"></i></label>
				<br />
				<label>Punkte bester Spieltag: <i id="besterTag"></i></label>
			</div>
		</div>
	</div>
	<div class="row" style="display: none;" id="groupRow">
		<div class="col-md-12">
			<div class="dropdown">
				<button class="btn btn-primary dropdown-toggle" type="button" id="about-us" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Gruppe 1
				</button>
				<div class="dropdown-menu" aria-labelledby="about-us">
					<a class="dropdown-item" href="#">Gruppe 2</a>
					<a class="dropdown-item" href="#">Gruppe 3</a>
					<a class="dropdown-item" href="#">Gruppe 4</a>
				</div>
			</div>
			<div class="text-center">
				<label>Gruppenname</label>
					<table id="gruppenTable">
						<thead>
							<tr>
								<td>Platz</td>
								<td>Name</td>
								<td>Punkte</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>1</td>
								<td>Max Mmustermann 1</td>
								<td>99</td>
							</tr>
							<tr>
								<td>2</td>
								<td>Max Mmustermann 2</td>
								<td>92</td>
							</tr>
							<tr>
								<td>3</td>
								<td>Max Mmustermann 3</td>
								<td>79</td>
							</tr>
							<tr>
								<td>4</td>
								<td>Max Mmustermann 4</td>
								<td>49</td>
							</tr>
							<tr>
								<td>5</td>
								<td>Max Mmustermann 5</td>
								<td>19</td>
							</tr>
						</tbody>
					</table>	
			</div>
			
		</div>
	</div>

		<!-- Modal -->
	<div class="modal fade" id="TitelModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="exampleModalLabel">Achievments</h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        <span aria-hidden="true">&times;</span>
		        </button>
	      </div>
	      <div class="modal-body">
		        Liste der Achivements
		        <table class="table">
		        	<thead>
		        		<tr>
		        			<td>
		        				
		        			</td>
		        			<td>
		        				Icon
		        			</td>
		        			<td>
		        				Titel
		        			</td>
		        			<td>
		        				Beschreibung
		        			</td>
		        		</tr>
		        	</thead>
		        	<tbody>
		        		<tr>
		        			<td><input type="radio" name="Androidmeister" class="achv_radio"></td>
		        			<td><i class="fab fa-android"></i></td>
		        			<td>Androidmeister</td>
		        			<td>50 richtige Tipps</td>
		        		</tr>
		        		<tr>
		        			<td><input type="radio" name="Androidmeister2" class="achv_radio"></td>
		        			<td><i class="fab fa-amilia"></i></td>
		        			<td>Androidmeister2</td>
		        			<td>50 richtige Tipps</td>
		        		</tr>
		        		<tr>
		        			<td><input type="radio" name="Androidmeister3" class="achv_radio"></td>
		        			<td><i class="fab fa-android"></i></td>
		        			<td>Androidmeister3</td>
		        			<td>50 richtige Tipps</td>
		        		</tr>
		        		<tr>
		        			<td><input type="radio" name="Androidmeister4" class="achv_radio"></td>
		        			<td><i class="fab fa-amilia"></i></td>
		        			<td>Androidmeister4</td>
		        			<td>50 richtige Tipps</td>
		        		</tr>
		        	</tbody>
		        </table>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	        <button type="button" class="btn btn-primary" id="changeTitel">Übernehmen</button>
	      </div>
	    </div>
	  </div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){

		var searchName = getUrlParameter('name');
		if(searchName == null)
		{
			$('#groupRow').css('display', 'flex');

			$('#gruppenTable').DataTable();

			$('#editTitel').css('display', 'inline-block');
			$('#editTitel').click(function(){
				$('#TitelModal').modal('show');	
			});

			$('#changeTitel').click(function(){
				$.each($('.achv_radio'),function(i,v){
					if($(v).prop("checked") == true)
					{
						$('#cur_Titel').text($(v).prop("name"));
					}
				});
				$('#TitelModal').modal('hide');
				lieferNeueDaten($('#cur_Titel').text(), "titel");
			});

			$('#file-input').change(function(){
				lieferNeueDaten($('#file-input').val(), "bild");
			});

			var token2 = Cookies.get('token');
			if (typeof token2 != 'undefined') {
				$.getJSON("backend/user/get/" + token2, function(result){
					$('#name').val(result.userName);
					var pic = result.userPicture;
					if(pic != null){
						$('#profilBild').attr('src', pic);
					}
					$('#aktPkt').val(result.Punkte);
					$('#aktPlatz').val(result.Platz);
					$('#besterTag').val(result.Bester);
				});
			}
			else{
				window.location.href = urlPath + '?page=login';
			}
			
			function lieferNeueDaten(daten, was){
				var token2 = Cookies.get('token');
				if (typeof token2 != 'undefined') {
					if(was == "titel")
					{
						$.ajax({
						  type: "POST",
						  headers: { 
						        'Content-Type': 'application/json' 
						  },
						  url: "backend/user/setAchievment/" + token2,
						  data: JSON.stringify(daten),
						  success: function(response){
						  	location.reload();	
						  },
						  dataType: "json"
						});
					}
					else
					{
						$.ajax({
						  type: "POST",
						  headers: { 
						        'Content-Type': 'application/json' 
						  },
						  url: "backend/user/setImage/" + token2,
						  data: JSON.stringify("https://as.ftcdn.net/r/v1/pics/ea2e0032c156b2d3b52fa9a05fe30dedcb0c47e3/landing/images_photos.jpg"),
						  success: function(response){
						  	location.reload();	
						  },
						  dataType: "json"
						});	
					}
				}
				else{
					window.location.href = urlPath + '?page=login';
				}
			}	
		}
		else
		{
			//ajax call für den jeweiligen User
			//variable für aktPkt, aktPlatz, besterTag, username, bild
			$.ajax({
				type: "GET",
				url: "backend/user/getByName?token=" + token + "&userName=" + searchName,
				success: function(result){
					$('#name').val(result.userName);
					var pic = result.userPicture;
					if(pic != null){
						$('#profilBild').attr('src', pic);
					}
					$('#aktPkt').val(result.Punkte);
					$('#aktPlatz').val(result.Platz);
					$('#besterTag').val(result.Bester);
				}
			});
		}
		
	});
</script>